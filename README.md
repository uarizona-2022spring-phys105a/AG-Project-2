# Project-2
PHYS 105 Project 2; Barnes-Hut simulation and analysis 

The goal of this project was to produce a simulation of Saturn's ring's, show that after sufficient time, gaps will open in the rings due to the presence of moons, qualitatively describe the impact of simulation granularity parameters on the accuracy of the model, and determine convergence characteristics for the Barnes-Hut algorithm.

In a general n-body simulation, the naive approach is to calculate the forces between each individual pair of objects in the simulation. This will result in an O(n^2) complexity, as each particle will experience a force from each other object. One can somewhat optimize this naive approach by using Newton’s third law to simultaneously update accelerations for pairs of objects at a time, but this will have a complexity of at least O[n(n − 1)/2], since the first object will have n computations, the next n-1, etc. This complexity unfortunately reduces to O(n^2) in the asymptotic limit. Thus, a brute-force approach of calculating forces between each pair of objects is infeasible for a large number of debris objects, which can easily number in excess of the tens or hundreds of thousands, or even millions. This simulation considered tens of thousands of individual particles, so a Barnes-Hut quadtree algorithm, which has a formal complexity of O[nlog(n)], was employed to integrate the motions of the system in a feasible amount of computational time.

The Barnes-Hut algorithm uses an octree or quadtree data structure to discretize the space in the simulation. The parent tree represents all of space, and is split into eight (or four) children, representing subdivisions in space. These child trees are then further subdivided until a desired criteria is met. In my simulation, I used a traditional Barnes-Hut quadtree implementation, which subdivides the space into quadrants such that each lowest level quadrant contains either one or no particles. One important feature is that although parent trees do not contain any particles, they do store a mass equal to the total sum of the masses of each child tree. One can then choose a parameter, theta, defined as the ratio of the width of a given tree to its distance to a sample object. If a parent tree is far enough away from a particle, the forces from its constituents can be taken to be approximately equal to the force from the sum of the contained mass located at the center of the tree. By performing this operation, a given particle only needs to calculate the precise forces from nearby objects, while only considering a much lesser number of forces from distant parent trees. Although the complexity of the algorithm is lower than the naive method, general overheads with creating and accessing the quadtree structure often mean that low n-body simulations often run much faster with a brute-force approach. However, for a simulation like this one with tens of thousands of bodies, the Barnes-Hut process transforms the problem from an untenable one to one which can be computed with significant computational effort.

This simulation considered Saturn, its 7 largest moons, and 30,000 debris objects distributed evenly about the planet in a disc. To reduce the total amount of computational power required, the mass of the innermost moon, Mimas, which is responsible for multiple of the most visible gaps in the system, was increased by 100 times. The following result was generated after about 15 hours of runtime: https://youtu.be/mcLuIknSxzg. For comparison, a brute force method with 0-mass debris particles was simulated using the Numba Just-In-Time C compiler, which yielded nearly identical results: Original - https://youtu.be/Imt2bq3ZTUU, Nicer looking - https://youtu.be/GuyZ6A8KXqk. The leapfrog integration method was used to compute motion for both cases. The gaps are generated due to a phenomenon known as orbital resonance. If a particle in the ring happens to orbit Saturn at close to an exact even ratio with a moon, then its orbit will coincide with the moon regularly, which will cause repeated resonant forces, destabilizing the orbit. For example, if an object orbits Saturn three times for every orbit of Mimas, the objects will line up every third orbit of the inner object. However, if the objects are slightly misaligned, a gravitational force will pull the debris particle further away from the resonant orbit, causing the object to be disrupted or even ejected. Because the orbital period of an object depends only on its distance from the central body, these destabilizing orbits occur at specific radii away from the planet, which are observed as gaps in the otherwise roughly continuous ring structure.

To examine convergence, I include several plots showing various qualitative and quantitative observations about the system and simulations. Convergence plots were created by integrating the motion of a sample particle over a small time-step using several different theta parameters. Due to the relatively slow speed of the simulation, a longer simulation could not be conducted, even though the number of objects for these analyses was reduced to roughly 500. However, the plots still show the general shape of convergence for the objects. Although the general trend is rapid convergence, the profiles are complicated, and the convergence with respect to number of sample points neglects the fact that time increases much more slowly than linearly with increasing number of sample points. The Force Calculations vs Theta plots show the number of sample points for differing theta values, including a fitted exponential model and error analysis using a residual plot. I include force distribution plots which visually display the points used for force calculations on a sample particle for multiple values of the theta parameter. Finally, the simulation video clips are a stitched image sequence displaying short runs of the simulation for several theta values.

In general, convergence is complicated, and although the simulation tends to quickly approach low error values with a relatively modest increase in sample points, this comes at significant computational cost. Still, the computation with 30,000 debris objects was successful in showing the opening of gaps in the Saturn system, and these results agree with a brute-force simulation, so it can be asserted that the simulation is likely to be accurate.
